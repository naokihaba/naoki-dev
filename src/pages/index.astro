---
import { getCollection } from 'astro:content'
import BaseHead from '../components/BaseHead.astro'
import Footer from '../components/Footer.astro'
import FormattedDate from '../components/FormattedDate.astro'
import Header from '../components/Header.astro'
import { SITE_DESCRIPTION, SITE_TITLE } from '../consts'
import { css } from '../../styled-system/css'

const posts = (await getCollection('blog', ({ data }) => data.published)).sort((a, b) => b.data.published_at.valueOf() - a.data.published_at.valueOf())
---

<!doctype html>
<html lang="ja">
  <head>
    <BaseHead title={SITE_TITLE} description={SITE_DESCRIPTION} />
  </head>
  <body>
    <Header />
    <main class={css({ maxWidth: '1200px', margin: '0 auto', padding: '2rem 1rem' })}>
      <div class={css({ marginBottom: '1.5rem', textAlign: 'right' })}>
        <a
          href="/tags/"
          class={css({
            fontSize: '0.875rem',
            color: 'textMuted',
            textDecoration: 'none',
            _hover: { color: 'accent' },
          })}
        >
          タグ一覧 →
        </a>
      </div>
      <ul
        class={css({
          listStyleType: 'none',
          margin: 0,
          padding: 0,
          display: 'grid',
          gridTemplateColumns: 'repeat(3, 1fr)',
          gap: '1.5rem',
        })}
      >
        {
          posts.map((post) => (
            <li>
              <a
                href={`/blog/${post.id}/`}
                class={css({
                  display: 'block',
                  textDecoration: 'none',
                  borderRadius: '16px',
                  overflow: 'hidden',
                  background: 'card',
                  boxShadow: '0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)',
                  transition: 'all 0.3s ease',
                  _hover: {
                    transform: 'translateY(-4px)',
                    boxShadow: '0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04)',
                  },
                })}
              >
                <div
                  class={css({
                    overflow: 'hidden',
                    display: 'flex',
                    justifyContent: 'center',
                    alignItems: 'center',
                  })}
                >
                  <img
                    src={`/og/${post.id}.png`}
                    alt=""
                    class={css({
                      width: '100%',
                      height: '100%',
                      objectFit: 'cover',
                    })}
                  />
                </div>
                <div class={css({ padding: '16px 20px' })}>
                  <h2
                    class={css({
                      margin: 0,
                      marginBottom: '8px',
                      color: 'textHeading',
                      fontSize: '0.95rem',
                      fontWeight: 600,
                      lineHeight: 1.5,
                      display: '-webkit-box',
                      WebkitLineClamp: 2,
                      overflow: 'hidden',
                    })}
                  >
                    {post.data.title}
                  </h2>
                  <time
                    class={css({
                      display: 'block',
                      color: 'textMuted',
                      fontSize: '0.75rem',
                    })}
                  >
                    <FormattedDate date={post.data.published_at} />
                  </time>
                </div>
              </a>
            </li>
          ))
        }
      </ul>
    </main>
    <Footer />
  </body>
</html>
