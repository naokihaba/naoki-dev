---
import { getCollection } from 'astro:content'
import BaseHead from '../components/BaseHead.astro'
import Footer from '../components/Footer.astro'
import FormattedDate from '../components/FormattedDate.astro'
import Header from '../components/Header.astro'
import { SITE_DESCRIPTION, SITE_TITLE } from '../consts'
import { css } from '../../styled-system/css'

const posts = (await getCollection('blog', ({ data }) => data.published)).sort((a, b) => b.data.published_at.valueOf() - a.data.published_at.valueOf())
---

<!doctype html>
<html lang="ja">
  <head>
    <BaseHead title={SITE_TITLE} description={SITE_DESCRIPTION} />
  </head>
  <body>
    <Header />
    <main class={css({ maxWidth: '1200px', margin: '0 auto', padding: { base: '1rem 0.75rem', md: '1.5rem 1rem', lg: '2rem 1rem' } })}>
      <div class={css({ marginBottom: '1.5rem', textAlign: 'right' })}>
        <a
          href="/tags/"
          class={css({
            fontSize: '0.875rem',
            color: 'textMuted',
            textDecoration: 'none',
            _hover: { color: 'accent' },
          })}
        >
          タグ一覧 →
        </a>
      </div>
      <ul
        class={css({
          listStyleType: 'none',
          margin: 0,
          padding: 0,
          display: 'grid',
          gridTemplateColumns: { base: '1fr', md: 'repeat(2, 1fr)', lg: 'repeat(3, 1fr)' },
          gap: { base: '1rem', md: '1.25rem', lg: '1.5rem' },
        })}
      >
        {
          posts.map((post) => (
            <li class={css({ height: '100%' })}>
              <a
                href={`/blog/${post.id}/`}
                class={css({
                  display: 'flex',
                  flexDirection: 'column',
                  height: '100%',
                  textDecoration: 'none',
                  borderRadius: { base: '12px', md: '14px', lg: '16px' },
                  overflow: 'hidden',
                  background: 'card',
                  boxShadow: '0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)',
                  transition: 'all 0.3s ease',
                  _hover: {
                    transform: 'translateY(-4px)',
                    boxShadow: '0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04)',
                  },
                })}
              >
                <div
                  class={css({
                    overflow: 'hidden',
                    display: 'flex',
                    justifyContent: 'center',
                    alignItems: 'center',
                  })}
                >
                  <img
                    src={`/og/${post.id}.png`}
                    alt=""
                    class={css({
                      width: '100%',
                      height: '100%',
                      objectFit: 'cover',
                    })}
                  />
                </div>
                <div class={css({ padding: { base: '12px 14px', md: '14px 18px', lg: '16px 20px' }, flex: 1, display: 'flex', flexDirection: 'column', justifyContent: 'space-between' })}>
                  <h2
                    class={css({
                      margin: 0,
                      marginBottom: '8px',
                      color: 'textHeading',
                      fontSize: '0.85rem',
                      fontWeight: 600,
                      lineHeight: 1.5,
                      display: '-webkit-box',
                      WebkitLineClamp: 2,
                      overflow: 'hidden',
                    })}
                  >
                    {post.data.title}
                  </h2>
                  <time
                    class={css({
                      display: 'block',
                      color: 'textMuted',
                      fontSize: '0.75rem',
                    })}
                  >
                    <FormattedDate date={post.data.published_at} />
                  </time>
                </div>
              </a>
            </li>
          ))
        }
      </ul>
    </main>
    <Footer />

    <script>
      import { animate, stagger, inView } from 'motion'

      function initAnimations() {
        const cards = document.querySelectorAll<HTMLElement>('ul > li')

        cards.forEach((card) => {
          card.style.opacity = '0'
          card.style.transform = 'translateY(24px)'
        })

        inView(
          'ul',
          () => {
            animate(
              cards,
              { opacity: [0, 1], y: [24, 0] },
              { type: 'spring', delay: stagger(0.1), duration: 0.6 }
            )
          },
          { amount: 0.1 }
        )
      }

      initAnimations()
      document.addEventListener('astro:after-swap', initAnimations)
    </script>
  </body>
</html>
