---
import { getCollection } from 'astro:content';
import BaseHead from '../../components/BaseHead.astro';
import Footer from '../../components/Footer.astro';
import Header from '../../components/Header.astro';
import { SITE_TITLE } from '../../consts';
import { css } from '../../../styled-system/css';

const posts = await getCollection('blog');

const tagCounts = posts.reduce((acc, post) => {
  post.data.tags.forEach((tag) => {
    acc[tag] = (acc[tag] || 0) + 1;
  });
  return acc;
}, {} as Record<string, number>);

const sortedTags = Object.entries(tagCounts).sort((a, b) => b[1] - a[1]);
---

<!doctype html>
<html lang="ja">
  <head>
    <BaseHead title={`タグ一覧 | ${SITE_TITLE}`} description="ブログ記事のタグ一覧" />
  </head>
  <body>
    <Header />
    <main class={css({ maxWidth: '720px', margin: '0 auto', padding: '2rem 1rem' })}>
      <h1 class={css({ fontSize: '1.5rem', marginBottom: '1.5rem' })}>タグ一覧</h1>
      <div class={css({
        display: 'flex',
        flexWrap: 'wrap',
        gap: '0.75rem',
      })}>
        {sortedTags.map(([tag, count]) => (
          <a
            href={`/tags/${tag}/`}
            class={css({
              display: 'inline-flex',
              alignItems: 'center',
              gap: '0.5rem',
              padding: '0.5rem 1rem',
              fontSize: '0.875rem',
              color: 'accent',
              bg: 'bgCode',
              borderRadius: '9999px',
              textDecoration: 'none',
              transition: 'all 0.2s ease',
              _hover: {
                bg: 'accent',
                color: 'bg',
              },
            })}
          >
            <span>#{tag}</span>
            <span class={css({
              fontSize: '0.75rem',
              color: 'textMuted',
              bg: 'bg',
              padding: '0.125rem 0.5rem',
              borderRadius: '9999px',
            })}>{count}</span>
          </a>
        ))}
      </div>
    </main>
    <Footer />
  </body>
</html>
