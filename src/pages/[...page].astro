---
import type { GetStaticPaths } from 'astro';
import { getCollection } from 'astro:content';
import BaseHead from '../components/BaseHead.astro';
import Footer from '../components/Footer.astro';
import FormattedDate from '../components/FormattedDate.astro';
import Header from '../components/Header.astro';
import TagList from '../components/TagList.astro';
import { SITE_DESCRIPTION, SITE_TITLE } from '../consts';
import { css } from '../../styled-system/css';

export const getStaticPaths = (async ({ paginate }) => {
  const posts = (await getCollection('blog')).sort(
    (a, b) => a.data.pubDate.valueOf() - b.data.pubDate.valueOf(),
  );
  return paginate(posts, { pageSize: 10 });
}) satisfies GetStaticPaths;

const { page } = Astro.props;
---

<!doctype html>
<html lang="ja">
  <head>
    <BaseHead
      title={page.currentPage === 1 ? SITE_TITLE : `${SITE_TITLE} - Page ${page.currentPage}`}
      description={SITE_DESCRIPTION}
    />
  </head>
  <body>
    <Header />
    <main class={css({ maxWidth: '720px', margin: '0 auto', padding: '2rem 1rem' })}>
      <ul class={css({
        listStyleType: 'none',
        margin: 0,
        padding: 0,
      })}>
        {
          page.data.map((post) => (
            <li class={css({
              borderBottom: '1px solid',
              borderColor: 'border',
              paddingBottom: '1.5rem',
              marginBottom: '1.5rem',
              _last: {
                borderBottom: 'none',
                marginBottom: 0,
              },
            })}>
              <a href={`/blog/${post.id}/`} class={css({
                display: 'block',
                textDecoration: 'none',
                transition: '0.2s ease',
                _hover: {
                  '& h2': { color: 'accent' },
                },
              })}>
                <time class={css({
                  display: 'block',
                  color: 'textMuted',
                  fontSize: '0.875rem',
                  marginBottom: '0.5rem',
                })}>
                  <FormattedDate date={post.data.pubDate} />
                </time>
                <h2 class={css({
                  margin: 0,
                  color: 'textHeading',
                  fontSize: '1.25rem',
                  lineHeight: 1.4,
                })}>{post.data.title}</h2>
                {post.data.description && (
                  <p class={css({
                    margin: '0.5rem 0 0',
                    color: 'textMuted',
                    fontSize: '0.9rem',
                    lineHeight: 1.6,
                  })}>{post.data.description}</p>
                )}
              </a>
              <TagList tags={post.data.tags} />
            </li>
          ))
        }
      </ul>

      {page.lastPage > 1 && (
        <nav class={css({
          display: 'flex',
          justifyContent: 'center',
          alignItems: 'center',
          gap: '1rem',
          marginTop: '2rem',
          paddingTop: '1.5rem',
          borderTop: '1px solid',
          borderColor: 'border',
        })}>
          {page.url.prev && (
            <a href={page.url.prev} class={css({
              color: 'accent',
              textDecoration: 'none',
              _hover: { textDecoration: 'underline' },
            })}>← 前のページ</a>
          )}
          <span class={css({ color: 'textMuted', fontSize: '0.875rem' })}>
            {page.currentPage} / {page.lastPage}
          </span>
          {page.url.next && (
            <a href={page.url.next} class={css({
              color: 'accent',
              textDecoration: 'none',
              _hover: { textDecoration: 'underline' },
            })}>次のページ →</a>
          )}
        </nav>
      )}
    </main>
    <Footer />
  </body>
</html>
