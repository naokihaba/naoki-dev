---
import type { GetStaticPaths } from 'astro';
import { getCollection } from 'astro:content';
import BaseHead from '../components/BaseHead.astro';
import Footer from '../components/Footer.astro';
import FormattedDate from '../components/FormattedDate.astro';
import Header from '../components/Header.astro';
import TagList from '../components/TagList.astro';
import { SITE_DESCRIPTION, SITE_TITLE } from '../consts';
import { css } from '../../styled-system/css';

export const getStaticPaths = (async ({ paginate }) => {
  const posts = (await getCollection('blog')).sort(
    (a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf(),
  );
  return paginate(posts, { pageSize: 10 });
}) satisfies GetStaticPaths;

const { page } = Astro.props;
---

<!doctype html>
<html lang="ja">
  <head>
    <BaseHead
      title={page.currentPage === 1 ? SITE_TITLE : `${SITE_TITLE} - Page ${page.currentPage}`}
      description={SITE_DESCRIPTION}
    />
  </head>
  <body>
    <Header />
    <main class={css({ maxWidth: '900px', margin: '0 auto', padding: '2rem 1rem' })}>
      <ul class={css({
        listStyleType: 'none',
        margin: 0,
        padding: 0,
        display: 'grid',
        gap: '1.5rem',
      })}>
        {
          page.data.map((post) => (
            <li>
              <a href={`/blog/${post.id}/`} class={css({
                display: 'block',
                textDecoration: 'none',
                borderRadius: '16px',
                overflow: 'hidden',
                background: 'card',
                boxShadow: '0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)',
                transition: 'all 0.3s ease',
                _hover: {
                  transform: 'translateY(-4px)',
                  boxShadow: '0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04)',
                  '& img': { transform: 'scale(1.05)' },
                },
              })}>
                <div class={css({ overflow: 'hidden', aspectRatio: '1200 / 630' })}>
                  <img
                    src={`/og/${post.id}.png`}
                    alt=""
                    class={css({
                      width: '100%',
                      height: '100%',
                      objectFit: 'cover',
                      transition: 'transform 0.3s ease',
                    })}
                  />
                </div>
                <div class={css({ padding: '1.25rem' })}>
                  <time class={css({
                    display: 'block',
                    color: 'textMuted',
                    fontSize: '0.8rem',
                    marginBottom: '0.5rem',
                  })}>
                    <FormattedDate date={post.data.pubDate} />
                  </time>
                  <h2 class={css({
                    margin: 0,
                    color: 'textHeading',
                    fontSize: '1.1rem',
                    fontWeight: 600,
                    lineHeight: 1.5,
                  })}>{post.data.title}</h2>
                  {post.data.description && (
                    <p class={css({
                      margin: '0.5rem 0 0',
                      color: 'textMuted',
                      fontSize: '0.85rem',
                      lineHeight: 1.6,
                      lineClamp: 2,
                    })}>{post.data.description}</p>
                  )}
                  {post.data.tags.length > 0 && (
                    <div class={css({ marginTop: '0.75rem' })}>
                      <TagList tags={post.data.tags} />
                    </div>
                  )}
                </div>
              </a>
            </li>
          ))
        }
      </ul>

      {page.lastPage > 1 && (
        <nav class={css({
          display: 'flex',
          justifyContent: 'center',
          alignItems: 'center',
          gap: '1rem',
          marginTop: '2rem',
          paddingTop: '1.5rem',
          borderTop: '1px solid',
          borderColor: 'border',
        })}>
          {page.url.prev && (
            <a href={page.url.prev} class={css({
              color: 'accent',
              textDecoration: 'none',
              _hover: { textDecoration: 'underline' },
            })}>← 前のページ</a>
          )}
          <span class={css({ color: 'textMuted', fontSize: '0.875rem' })}>
            {page.currentPage} / {page.lastPage}
          </span>
          {page.url.next && (
            <a href={page.url.next} class={css({
              color: 'accent',
              textDecoration: 'none',
              _hover: { textDecoration: 'underline' },
            })}>次のページ →</a>
          )}
        </nav>
      )}
    </main>
    <Footer />
  </body>
</html>
